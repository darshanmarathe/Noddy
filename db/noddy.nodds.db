{"_id":"lSjV3LaYC3In76B0","ownedBy":"cFfwsbPfKgkL3grk","Title":"Three pieces need to be configured to use Passport for authentication:","Description":"Passport uses what are termed strategies to authenticate requests. Strategies range from verifying a username and password, delegated authentication using OAuth or federated authentication using OpenID.\r\n\r\nBefore asking Passport to authenticate a request, the strategy (or strategies) used by an application must be configured.\r\n\r\nStrategies, and their configuration, are supplied via the use() function. For example, the following uses the LocalStrategy for username/password authentication.\r\n    \r\n    \r\n   ","ClientSideCode":"<nocode>\r\n</nocode>    \r\n    \r\n   ","ServerSideCode":"var passport = require('passport')\r\n  , LocalStrategy = require('passport-local').Strategy;\r\n\r\npassport.use(new LocalStrategy(\r\n  function(username, password, done) {\r\n    User.findOne({ username: username }, function (err, user) {\r\n      if (err) { return done(err); }\r\n      if (!user) {\r\n        return done(null, false, { message: 'Incorrect username.' });\r\n      }\r\n      if (!user.validPassword(password)) {\r\n        return done(null, false, { message: 'Incorrect password.' });\r\n      }\r\n      return done(null, user);\r\n    });\r\n  }\r\n));\r\n\r\n//Middleware\r\napp.configure(function() {\r\n  app.use(express.static('public'));\r\n  app.use(express.cookieParser());\r\n  app.use(express.bodyParser());\r\n  app.use(express.session({ secret: 'keyboard cat' }));\r\n  app.use(passport.initialize());\r\n  app.use(passport.session());\r\n  app.use(app.router);\r\n});\r\n\r\n//Sessions\r\npassport.serializeUser(function(user, done) {\r\n  done(null, user.id);\r\n});\r\n\r\npassport.deserializeUser(function(id, done) {\r\n  User.findById(id, function(err, user) {\r\n    done(err, user);\r\n  });\r\n});\r\n\r\n \r\n   ","Tags":"Security , Auth","Modules":"express, passport","updatedBy":"cFfwsbPfKgkL3grk","UpdatedOn":{"$$date":1381398645718}}
